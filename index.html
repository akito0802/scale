
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Tber - スケール辞典（再構築版）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { font-family: sans-serif; background: #f0f4f8; padding: 20px; text-align: center; }
    select { font-size: 1em; margin: 10px; padding: 5px; }
    table { margin: 20px auto; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px 14px; background: white; }
    #description { margin-top: 30px; font-size: 1em; max-width: 800px; margin-left: auto; margin-right: auto; }
  </style>
</head>
<body>
  <h1>Tber スケール辞典</h1>
  <div>
    <select id="keySelect"></select>
    <select id="groupSelect"></select>
    <select id="scaleSelect"></select>
  </div>

  <table id="noteTable"></table>
  <div id="description"></div>

  <script>
    let scaleData = {};
    fetch("scales.json")
      .then(response => response.json())
      .then(data => {
        scaleData = data;
        initSelectors();
      });

    function initSelectors() {
      const keySelect = document.getElementById("keySelect");
      const groupSelect = document.getElementById("groupSelect");
      const scaleSelect = document.getElementById("scaleSelect");

      keySelect.innerHTML = "";
      Object.keys(scaleData).forEach(key => {
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = key;
        keySelect.appendChild(opt);
      });

      keySelect.addEventListener("change", updateGroups);
      groupSelect.addEventListener("change", updateScales);
      scaleSelect.addEventListener("change", showScale);

      updateGroups();
    }

    function updateGroups() {
      const key = document.getElementById("keySelect").value;
      const groupSelect = document.getElementById("groupSelect");
      const groups = new Set();

      Object.values(scaleData[key]).forEach(info => {
        groups.add(info.group || "その他");
      });

      groupSelect.innerHTML = "";
      groups.forEach(group => {
        const opt = document.createElement("option");
        opt.value = group;
        opt.textContent = group;
        groupSelect.appendChild(opt);
      });

      updateScales();
    }

    function updateScales() {
      const key = document.getElementById("keySelect").value;
      const group = document.getElementById("groupSelect").value;
      const scaleSelect = document.getElementById("scaleSelect");
      scaleSelect.innerHTML = "";

      Object.entries(scaleData[key]).forEach(([scaleName, scaleInfo]) => {
        if (scaleInfo.group === group) {
          const opt = document.createElement("option");
          opt.value = scaleName;
          opt.textContent = scaleName;
          scaleSelect.appendChild(opt);
        }
      });

      showScale();
    }

    function showScale() {
      const key = document.getElementById("keySelect").value;
      const scaleName = document.getElementById("scaleSelect").value;
      const scale = scaleData[key][scaleName];
      const noteTable = document.getElementById("noteTable");
      const description = document.getElementById("description");

      if (!scale) return;

      const degrees = scale.degrees || [];
      const notes = scale.notes || [];

      noteTable.innerHTML = `
        <tr>${degrees.map(d => `<th>${d}</th>`).join("")}</tr>
        <tr>${notes.map(n => `<td>${n}</td>`).join("")}</tr>
      `;
      description.textContent = scale.description || "";
    }
  </script>
</body>
</html>
