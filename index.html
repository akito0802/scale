
<!DOCTYPE html>

<html lang="ja">
<head>
<meta charset="utf-8"/>
<title>Tber スケール辞典 - Fixed</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<style>
    body{font-family:sans-serif;background:#eef3f8;margin:0;padding:2rem;text-align:center}
    h1{margin-bottom:1rem}
    select{font-size:1.1rem;margin:.5rem;padding:.4rem .6rem}
    table{margin:1.5rem auto;border-collapse:collapse}
    th,td{border:1px solid #bbb;padding:.5rem 1rem;background:#fff}
    #description{max-width:800px;margin:1.5rem auto;font-size:1rem;line-height:1.5}
  </style>
</head>
<body>
<h1>Tber スケール辞典</h1>
<div>
<select id="keySelect"></select>
<select id="groupSelect"></select>
<select id="scaleSelect"></select>
</div>
<table id="scaleTable"></table>
<div id="description"></div>
<script>
let scaleData={};

fetch("scales.json").then(r=>r.json()).then(d=>{
  scaleData=d;
  initKeys();
});

function initKeys(){
  const keySel=document.getElementById("keySelect");
  keySel.innerHTML="";
  Object.keys(scaleData).forEach(k=>{
    const opt=document.createElement("option");
    opt.value=k;opt.textContent=k;
    keySel.appendChild(opt);
  });
  keySel.addEventListener("change",updateGroups);
  document.getElementById("groupSelect").addEventListener("change",updateScales);
  document.getElementById("scaleSelect").addEventListener("change",showScale);
  updateGroups();
}

function updateGroups(){
  const key=document.getElementById("keySelect").value;
  const groups=Object.keys(scaleData[key]);
  const groupSel=document.getElementById("groupSelect");
  groupSel.innerHTML="";
  groups.forEach(g=>{
    const opt=document.createElement("option");
    opt.value=g;opt.textContent=g;
    groupSel.appendChild(opt);
  });
  updateScales();
}

function updateScales(){
  const key=document.getElementById("keySelect").value;
  const group=document.getElementById("groupSelect").value;
  const scaleSel=document.getElementById("scaleSelect");
  scaleSel.innerHTML="";
  if(!scaleData[key][group]) return;
  Object.keys(scaleData[key][group]).forEach(s=>{
    const opt=document.createElement("option");
    opt.value=s;opt.textContent=s;
    scaleSel.appendChild(opt);
  });
  showScale();
}

function showScale(){
  const key=document.getElementById("keySelect").value;
  const group=document.getElementById("groupSelect").value;
  const scale=document.getElementById("scaleSelect").value;
  const tbl=document.getElementById("scaleTable");
  const descDiv=document.getElementById("description");
  if(!scaleData[key][group]||!scaleData[key][group][scale]){tbl.innerHTML="";descDiv.textContent="";return;}
  const arr=scaleData[key][group][scale]; // array of note objects
  const degrees=arr.map(o=>o.degree||"");
  const notes=arr.map(o=>o.name||"");
  const description=(arr[0]&&arr[0].description)?arr[0].description:"";
  tbl.innerHTML="<tr>"+degrees.map(d=>`<th>${d}</th>`).join("")+"</tr>"+
                "<tr>"+notes.map(n=>`<td>${n}</td>`).join("")+"</tr>";
  descDiv.textContent=description;
}
</script>
</body>
</html>
