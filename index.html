
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tber Scale Viewer</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f0f0f0; }
    select, table { margin: 1rem 0; padding: 0.5rem; font-size: 1rem; }
    .description { margin-top: 2rem; padding: 1rem; background: #fff; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>Tber Scale Viewer</h1>
  <label for="key">Key:</label>
  <select id="key"></select>

  <label for="group">分類:</label>
  <select id="group"></select>

  <label for="scale">スケール:</label>
  <select id="scale"></select>

  <div id="output">
    <table id="notes-table" border="1" cellpadding="8"></table>
    <div id="description" class="description"></div>
  </div>

  <script>
    const data = {};
    const keys = ["C", "C#", "D", "Eb", "E", "F", "F#", "G", "Ab", "A", "Bb", "B"];
    const groups = {
      "メジャー": ["メジャースケール", "メジャーペンタトニック", "メジャーブルース"],
      "マイナー": ["ナチュラルマイナー", "ハーモニックマイナー", "メロディックマイナー", "マイナーペンタトニック", "マイナーブルース"]
    };

    const baseScales = {
      "メジャースケール": { intervals: ["1", "2", "3", "4", "5", "6", "7"], desc: "明るく安定した印象。" },
      "メジャーペンタトニック": { intervals: ["1", "2", "3", "5", "6"], desc: "5音で構成され、民謡などでも使われる。" },
      "メジャーブルース": { intervals: ["1", "2", "♭3", "3", "5", "6"], desc: "ブルージーな響きに明るさを加えたスケール。" },
      "ナチュラルマイナー": { intervals: ["1", "2", "♭3", "4", "5", "♭6", "♭7"], desc: "悲しげで内省的な雰囲気。" },
      "ハーモニックマイナー": { intervals: ["1", "2", "♭3", "4", "5", "♭6", "7"], desc: "クラシックやラテン的な響き。" },
      "メロディックマイナー": { intervals: ["1", "2", "♭3", "4", "5", "6", "7"], desc: "上行と下行で変化することもある。" },
      "マイナーペンタトニック": { intervals: ["1", "♭3", "4", "5", "♭7"], desc: "ロックなどで頻繁に使用される5音スケール。" },
      "マイナーブルース": { intervals: ["1", "♭3", "4", "♭5", "5", "♭7"], desc: "ブルースの中心的スケール。" }
    };

    const chromatic = ["C", "C#", "D", "Eb", "E", "F", "F#", "G", "Ab", "A", "Bb", "B"];

    function transpose(note, semitones) {
      const i = chromatic.indexOf(note);
      return chromatic[(i + semitones + 12) % 12];
    }

    function getNoteByInterval(root, interval) {
      const semitoneMap = {
        "1": 0, "2": 2, "3": 4, "4": 5, "5": 7, "6": 9, "7": 11,
        "♭2": 1, "♭3": 3, "♯4": 6, "♭5": 6, "♯5": 8, "♭6": 8, "♭7": 10
      };
      return transpose(root, semitoneMap[interval] ?? 0);
    }

    keys.forEach(key => {
      data[key] = {};
      for (let group in groups) {
        data[key][group] = {};
        groups[group].forEach(scale => {
          const intervals = baseScales[scale].intervals;
          const notes = intervals.map(i => [i, getNoteByInterval(key, i)]);
          data[key][group][scale] = {
            notes: notes,
            description: `${key}${scale}：` + baseScales[scale].desc
          };
        });
      }
    });

    const keySelect = document.getElementById("key");
    const groupSelect = document.getElementById("group");
    const scaleSelect = document.getElementById("scale");
    const notesTable = document.getElementById("notes-table");
    const descriptionBox = document.getElementById("description");

    function updateKeyOptions() {
      keySelect.innerHTML = "";
      keys.forEach(k => {
        const opt = document.createElement("option");
        opt.value = k;
        opt.textContent = k;
        keySelect.appendChild(opt);
      });
    }

    function updateGroupOptions(key) {
      groupSelect.innerHTML = "";
      for (let group in data[key]) {
        const opt = document.createElement("option");
        opt.value = group;
        opt.textContent = group;
        groupSelect.appendChild(opt);
      }
    }

    function updateScaleOptions(key, group) {
      scaleSelect.innerHTML = "";
      for (let scale in data[key][group]) {
        const opt = document.createElement("option");
        opt.value = scale;
        opt.textContent = scale;
        scaleSelect.appendChild(opt);
      }
    }

    function updateDisplay(key, group, scale) {
      const notes = data[key][group][scale].notes;
      const desc = data[key][group][scale].description;
      notesTable.innerHTML = "<tr>" + notes.map(n => `<th>${n[0]}</th>`).join("") + "</tr>";
      notesTable.innerHTML += "<tr>" + notes.map(n => `<td>${n[1]}</td>`).join("") + "</tr>";
      descriptionBox.textContent = desc;
    }

    keySelect.addEventListener("change", () => {
      const prevGroup = groupSelect.value;
      const prevScale = scaleSelect.value;
      updateGroupOptions(keySelect.value);
      if (data[keySelect.value][prevGroup]) {
        groupSelect.value = prevGroup;
        updateScaleOptions(keySelect.value, prevGroup);
        if (data[keySelect.value][prevGroup][prevScale]) {
          scaleSelect.value = prevScale;
          updateDisplay(keySelect.value, prevGroup, prevScale);
        }
      }
    });

    groupSelect.addEventListener("change", () => {
      updateScaleOptions(keySelect.value, groupSelect.value);
      updateDisplay(keySelect.value, groupSelect.value, scaleSelect.value);
    });

    scaleSelect.addEventListener("change", () => {
      updateDisplay(keySelect.value, groupSelect.value, scaleSelect.value);
    });

    // 初期化
    updateKeyOptions();
    updateGroupOptions("C");
    updateScaleOptions("C", "メジャー");
    updateDisplay("C", "メジャー", "メジャースケール");
  </script>
</body>
</html>
